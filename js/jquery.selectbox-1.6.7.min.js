/*
 * jQuery selectbox plugin
 * Software License Agreement (BSD License)
 * Copyright (c) 2011, Andre Hayter (ahsquared.com)
 * All rights reserved.
 * The code is inspired from Sadri Sahraoui (brainfault.com) selectbox plugin
 * which in turn was inspired by Autocomplete plugin (http://www.dyve.net/jquery/?autocomplete)
* Revision: $Id$
 * Version: 1.6.7
 */

jQuery.fn.extend({ selectbox: function (a) { return this.each(function (b) { jQuery.SelectBox(this, a, b) }) } }); if (!window.console) { var console = { log: function (a) { } } } jQuery.SelectBox = function (a, b, c) { function w() { l = 0; h = false; m = false; r.hide(); if (!d.simple) { p.hide(); q.hide() } } function y() { if (!j) { var a = u.outerWidth(); if (!d.simple) { p.css("width", a); q.css("width", a) } j = true } } function z() { if (!i) { var a = t.height(); if (a > d.maxHeight) { r.height(d.maxHeight); if (!d.simple) { var b = p.outerHeight(); var c = u.outerHeight(); r.css({ top: b + c }) } var c = u.outerHeight(); r.css({ top: c }); t.height(d.maxHeight); var e = jQuery("ul", t).css("width"); jQuery("ul", t).css("width", parseInt(e, 10) - 5) } else { r.height(a) } i = true; if (jQuery.browser.msie && jQuery.browser.version.substr(0, 1) < 7) { k = parseInt(r.outerHeight(), 10) + parseInt(r.css("top"), 10) + parseInt(r.css("padding-top"), 10) - 4 } else { k = parseInt(r.outerHeight(), 10) + parseInt(r.css("top"), 10) + parseInt(r.css("padding-top"), 10) } if (!d.simple) { q.css("top", k) } } } function A(a) { t.append(M(u.attr(a.selectorType))); r.parent().css("zIndex", a.zIndex); var b = u.outerWidth(); r.width(b) } function B(a) { var b = document.createElement("div"); r = jQuery(b); r.attr("id", e + "_dd_wrapper"); r.addClass(a.dropdownWrapper); r.css({ display: "none" }); return r } function C(a) { var b = document.createElement("div"); p = jQuery(b); p.attr("id", e + "_dd_wrapper_top"); p.addClass(a.dropdownWrapperTop); p.css("display", "none"); return p } function D(a) { var b = document.createElement("div"); q = jQuery(b); q.attr("id", e + "_dd_wrapper_bottom"); q.addClass(a.dropdownWrapperBottom); q.css("display", "none"); return q } function E(a) { var b = document.createElement("div"); s = jQuery(b); s.attr("id", e + "_select_wrapper"); s.addClass(a.wrapper); return s } function F(a) { var b = document.createElement("div"); t = jQuery(b); t.attr("id", e + "_list_container"); t.addClass("dd_list_container"); return t } function G(a) { if (d.inputType == "span") { var b = document.createElement("span"); var c = jQuery(b); c.attr("id", e + "_input"); c.addClass(a.input); c.attr("tabIndex", o.attr("tabindex")); c.html(o.children().eq(a.selBoxIndex).html()) } else { var b = document.createElement("input"); var c = jQuery(b); c.attr("id", e + "_input"); c.attr("type", "text"); c.addClass(a.input); c.attr("autocomplete", "off"); c.attr("readonly", "readonly"); c.attr("tabIndex", o.attr("tabindex")); c.css("width", o.css("width")) } return c } function H(a) { var b = jQuery("li", t); if (!b || b.length === 0) { return false } firstchoice = 0; g += a; while ($(b[firstchoice]).hasClass(d.group)) { firstchoice++ } if ($(b[g]).hasClass(d.group)) { g += a } if (g < firstchoice) { d.noLooping ? g = 0 : g = b.size() - 1 } else if (g > b.size() - 1) { d.noLooping ? g = b.size() - 1 : g = 0 } I(b, g); b.removeClass(d.current); jQuery(b[g]).addClass(d.current) } function I(a, b) { var c = jQuery(a[b]).get(0); var a = t.get(0); if (c.offsetTop + c.offsetHeight > a.scrollTop + a.clientHeight) { a.scrollTop = c.offsetTop + c.offsetHeight - a.clientHeight } else if (c.offsetTop < a.scrollTop) { a.scrollTop = c.offsetTop } } function J() { var a = jQuery("li." + d.selected, t).get(0); var b = ("" + a.id).split("_"); var c = b[b.length - 1]; if (d.onChangeCallback) { o.get(0).selectedIndex = $("li", t).index(a); d.onChangeParams = { selectedVal: o.val() }; d.onChangeCallback(d.onChangeParams) } else { o.find("option:selected").prop("selected", ""); o.children('option[value="' + c + '"]').prop("selected", "selected"); var e = o[0].onchange; if (typeof e == "string") { setTimeout(e, 0) } else { o.change() } } if (d.inputType == "span") { u.html($(a).html()) } else { u.val($(a).html()) } return true } function K() { var b = 0; $(a).children().each(function (a) { if ($(this).attr("selected")) { b = a } }); return b } function L() { return u.val() } function M(a) { var b = []; var c = document.createElement("ul"); b = o.children("option"); if (b.length === 0) { var e = []; e = o.children("optgroup"); for (x = 0; x < e.length; x++) { b = $("#" + e[x].id).children("option"); var f = document.createElement("li"); f.setAttribute("id", a + "_" + $(this).val()); f.innerHTML = $("#" + e[x].id).attr("label"); f.className = d.group; c.appendChild(f); b.each(function () { var b = document.createElement("li"); b.setAttribute("id", a + "_" + $(this).val()); b.innerHTML = $(this).html(); if ($(this).is(":selected")) { u.html($(this).html()); $(b).addClass(d.selected) } c.appendChild(b); $(b).mouseover(function (a) { l = 1; if (d.debug) { } jQuery(a.target, r).addClass(d.current) }).mouseout(function (a) { l = -1; if (d.debug) { } jQuery(a.target, r).removeClass(d.current) }).click(function (a) { if (d.debug) { } $("li." + d.selected, r).removeClass(d.selected); $(this).addClass(d.selected); J(); o.get(0).blur(); w() }) }) } } else b.each(function () { var b = document.createElement("li"); b.setAttribute("id", a + "_" + $(this).val()); b.innerHTML = $(this).html(); if ($(this).is(":selected")) { u.val($(this).html()); $(b).addClass(d.selected) } c.appendChild(b); $(b).mouseover(function (a) { l = 1; if (d.debug) { } jQuery(a.target, t).addClass(d.current) }).mouseout(function (a) { l = -1; if (d.debug) { } jQuery(a.target, t).removeClass(d.current) }).click(function (a) { var b = $("li." + d.current, t).get(0); if (d.debug) { } $("li." + d.selected, t).removeClass(d.selected); $(this).addClass(d.selected); J(); o.get(0).blur(); w() }) }); return c } var d = b || {}; d.selectorType = d.selectorType || "id"; d.inputType = d.inputType || "span"; d.simple = d.simple || true; d.wrapper = d.wrapper || "select_wrapper"; d.input = d.input || "selectbox"; d.dropdownWrapper = d.dropdownWrapper || "dd_wrapper"; d.dropdownWrapperTop = d.dropdownWrapperTop || "dd_wrapper_top"; d.dropdownWrapperBottom = d.dropdownWrapperBottom || "dd_wrapper_bottom"; d.zIndex = d.zIndex - c || 1e3 - c; d.current = d.current || "dd_current"; d.selected = d.selected || "dd_selected"; d.group = d.group || "dd_group"; d.maxHeight = d.maxHeight || 110; d.matchWidth = d.matchWidth || true; d.noLooping = d.noLooping || false; d.selBoxIndex = d.selBoxIndex || K(); d.onChangeCallback = d.onChangeCallback || false; d.onChangeParams = d.onChangeParams || false; d.debug = d.debug || false; var e = a.id; var f = $("#" + e + "_select_wrapper"); if (f.length > 0) { $("#" + e + "_select_wrapper").remove() } var g = -1; var h = false; var i = false; var j = false; var k = 0; var l = 0; var m = false; var n = false; var o = jQuery(a); if (!d.simple) { var p = C(d); var q = D(d) } var r = B(d); var s = E(d); var t = F(d); var u = G(d); if (d.matchWidth && o.filter(":visible").length > 0) { var v = o.outerWidth(); u.width(v) } o.css({'visibility': 'hidden','position': 'absolute','left':'-9999px'}).before(s); if (d.simple) { s.append(u).append(r) } else { s.append(u).append(p).append(r).append(q) } r.append(t); if (o.attr("disabled")) { s.addClass("disabled"); n = true } A(d); u.click(function () { if (!h && !n) { r.toggle(); if (!d.simple) { p.toggle(); q.toggle() } } }).focus(function () { if (r.not(":visible") && !n) { h = true; r.show(); z(); y(); if (!d.simple) { p.show(); q.show() } } }).keydown(function (a) { if (!n) { switch (a.keyCode) { case 38: a.preventDefault(); H(-1); break; case 40: a.preventDefault(); H(1); break; case 13: a.preventDefault(); $("li." + d.current).trigger("click"); break; case 27: w(); break } } }).blur(function () { if (!n) { if (!m) { w() } else { $(this).focus() } } }); s.mouseenter(function () { m = true }); s.mouseleave(function () { m = false }) }